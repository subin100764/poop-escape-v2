<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë˜¥ í•˜ìˆ˜ë„ íƒˆì¶œ</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { margin: 0; padding: 0; overflow: hidden; background: #5d4037; font-family: sans-serif; touch-action: none; }
        #wrapper { position: relative; width: 100vw; height: 100vh; max-width: 500px; margin: 0 auto; background: #808080; }
        canvas { display: block; width: 100%; height: 100%; background: #444; }

        /* í™”ë©´ ë ˆì´ì–´ ê³µí†µ */
        .layer { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: white; text-align: center; }
        
        /* í™ˆ í™”ë©´ */
        #home-screen { background: #5d4037; }
        .pixel-poop { font-size: 80px; margin-bottom: 20px; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn { padding: 15px 40px; font-size: 20px; font-weight: bold; color: white; background: #8d6e63; border: 4px solid #3e2723; border-radius: 10px; cursor: pointer; margin-top: 20px; }
        .btn:active { background: #3e2723; }

        /* UI (ìƒë‹¨ ì •ë³´) */
        #ui { position: absolute; top: 10px; left: 0; width: 100%; display: flex; justify-content: space-around; font-size: 20px; font-weight: bold; color: white; text-shadow: 2px 2px black; z-index: 50; pointer-events: none; }

        /* ê²°ê³¼ í™”ë©´ */
        #game-over { background: rgba(0,0,0,0.85); display: none; z-index: 200; }
        #win-screen { background: #2196f3; display: none; z-index: 300; }
        .swirl { font-size: 80px; animation: rotate 1s infinite linear; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="wrapper">
    <div id="ui">
        <div>ì‹œê°„: <span id="timer">30</span></div>
        <div>ë³„: <span id="star-count">0</span></div>
    </div>

    <div id="home-screen" class="layer">
        <div class="pixel-poop">ğŸ’©</div>
        <h1 style="margin:0;">í•˜ìˆ˜ë„ íƒˆì¶œ</h1>
        <p>ëˆ„ì  ë³„: <span id="total-stars-display">0</span></p>
        <div class="btn" onclick="gameStart()">íƒˆì¶œ ì‹œì‘!</div>
    </div>

    <div id="game-over" class="layer">
        <h2>íƒˆì¶œ ì‹¤íŒ¨...</h2>
        <div class="btn" onclick="gameContinue()">ê³„ì† (ë³„ 5ê°œ ì†Œëª¨)</div>
        <div class="btn" onclick="location.reload()" style="background:#555;">í™ˆìœ¼ë¡œ</div>
    </div>

    <div id="win-screen" class="layer">
        <div class="swirl">ğŸ’©</div>
        <h2>ë°”ë‹¤ íƒˆì¶œ ì„±ê³µ!</h2>
        <p>ë³€ê¸° ë¬¼ ë‚´ë ¤ê°€ëŠ” ì¤‘...</p>
    </div>

    <canvas id="gameCanvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    let gameActive = false;
    let score = 0;
    let timeLeft = 30;
    let totalStars = parseInt(localStorage.getItem('poop_stars_save')) || 0;
    
    let player = { x: 0, y: 120, size: 40 };
    let items = []; // ì¥ì• ë¬¼ê³¼ ë³„ í†µí•© ê´€ë¦¬

    // í™”ë©´ í¬ê¸° ì„¤ì •
    function resize() {
        canvas.width = document.getElementById('wrapper').clientWidth;
        canvas.height = document.getElementById('wrapper').clientHeight;
        player.x = canvas.width / 2 - 20;
    }
    window.addEventListener('load', () => {
        resize();
        document.getElementById('total-stars-display').innerText = totalStars;
    });

    // ì…ë ¥ ì œì–´ (í‚¤ë³´ë“œ + í„°ì¹˜)
    let moveDir = 0;
    window.addEventListener('keydown', e => {
        if(e.code === 'ArrowLeft') moveDir = -1;
        if(e.code === 'ArrowRight') moveDir = 1;
    });
    window.addEventListener('keyup', () => moveDir = 0);

    // í„°ì¹˜ ì œì–´ (ëª¨ë°”ì¼ìš©)
    canvas.addEventListener('touchstart', e => {
        const touchX = e.touches[0].clientX;
        moveDir = touchX < window.innerWidth / 2 ? -1 : 1;
    });
    canvas.addEventListener('touchend', () => moveDir = 0);

    function gameStart() {
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('game-over').style.display = 'none';
        resetData();
        gameActive = true;
        requestAnimationFrame(gameLoop);